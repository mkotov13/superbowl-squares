<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Bowl Squares</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* Tab Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            padding: 15px 20px 0;
            position: sticky;
            top: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            z-index: 100;
        }
        .tab {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #aaa;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab:first-child {
            border-radius: 8px 0 0 8px;
        }
        .tab:last-child {
            border-radius: 0 8px 8px 0;
        }
        .tab.active {
            background: #4fc3f7;
            color: #1a1a2e;
        }

        /* Views Container */
        .views {
            display: flex;
            width: 200%;
            transition: transform 0.3s ease;
        }
        .views.show-grid {
            transform: translateX(-50%);
        }
        .view {
            width: 50%;
            min-height: calc(100vh - 60px);
            padding: 20px;
        }

        /* Live View */
        .live-view {
            display: flex;
            flex-direction: row;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        .main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
        }
        .score-input {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .team-name {
            font-size: 1.1rem;
            font-weight: 600;
        }
        .team input {
            width: 80px;
            height: 70px;
            font-size: 2.5rem;
            text-align: center;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .team input:focus {
            outline: 2px solid #4fc3f7;
        }
        .vs {
            font-size: 1.5rem;
            font-weight: bold;
            color: #aaa;
        }
        .result {
            text-align: center;
        }
        .winner-initials {
            font-size: 10rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin: 10px 0;
        }
        .winning-combo {
            font-size: 1.8rem;
            color: #4fc3f7;
            margin-bottom: 5px;
        }
        .no-winner {
            font-size: 3rem;
            color: #ff6b6b;
        }
        .live-score {
            margin-top: 20px;
            padding: 12px 24px;
            font-size: 1rem;
            background: #4fc3f7;
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: 600;
        }
        .live-score:hover {
            background: #29b6f6;
        }
        .status {
            margin-top: 12px;
            font-size: 0.85rem;
            color: #aaa;
        }

        /* Payouts */
        .payouts {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            min-width: 260px;
        }
        .payouts h2 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
        }
        .payout-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .payout-row:last-child {
            border-bottom: none;
        }
        .payout-quarter {
            font-weight: 600;
            color: #aaa;
            min-width: 45px;
        }
        .payout-amount {
            font-weight: 700;
            color: #4fc3f7;
        }
        .payout-winner {
            font-size: 1.4rem;
            font-weight: 900;
            color: #ffd700;
            min-width: 45px;
            text-align: center;
        }
        .payout-winner.pending {
            color: #666;
            font-size: 1rem;
        }
        .payout-score {
            font-size: 0.8rem;
            color: #888;
            min-width: 50px;
            text-align: center;
        }
        .payout-total {
            margin-top: 15px;
            padding-top: 12px;
            border-top: 2px solid rgba(255,255,255,0.2);
        }
        .payout-total h3 {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #aaa;
        }
        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
        }
        .total-initials {
            font-weight: 700;
            color: #ffd700;
        }
        .total-amount {
            font-weight: 700;
            color: #4fc3f7;
        }

        /* Grid View */
        .grid-view {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        .grid-view h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        .grid-subtitle {
            font-size: 0.85rem;
            color: #aaa;
            margin-bottom: 15px;
            text-align: center;
        }
        .grid-container {
            overflow-x: auto;
            max-width: 100%;
        }
        .squares-grid {
            border-collapse: collapse;
            font-size: 0.75rem;
        }
        .squares-grid th, .squares-grid td {
            width: 36px;
            height: 36px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .squares-grid th {
            background: rgba(79, 195, 247, 0.3);
            font-weight: 700;
            color: #4fc3f7;
        }
        .squares-grid .corner {
            background: transparent;
            border: none;
            font-size: 0.6rem;
            color: #888;
            line-height: 1.2;
        }
        .squares-grid td {
            background: rgba(255,255,255,0.05);
            font-weight: 600;
            transition: all 0.2s;
        }
        .squares-grid td.winner {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            color: #1a1a2e;
            font-weight: 900;
            font-size: 0.9rem;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        .squares-grid td.q1-winner {
            box-shadow: inset 0 0 0 2px #4fc3f7;
        }
        .squares-grid td.q2-winner {
            box-shadow: inset 0 0 0 2px #9c27b0;
        }
        .squares-grid td.q3-winner {
            box-shadow: inset 0 0 0 2px #ff9800;
        }

        /* Grid Legend */
        .grid-legend {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
            font-size: 0.75rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-box {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .legend-box.current {
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
        }
        .legend-box.q1 {
            background: rgba(255,255,255,0.05);
            box-shadow: inset 0 0 0 2px #4fc3f7;
        }
        .legend-box.q2 {
            background: rgba(255,255,255,0.05);
            box-shadow: inset 0 0 0 2px #9c27b0;
        }
        .legend-box.q3 {
            background: rgba(255,255,255,0.05);
            box-shadow: inset 0 0 0 2px #ff9800;
        }

        /* Swipe hint */
        .swipe-hint {
            text-align: center;
            color: #666;
            font-size: 0.8rem;
            padding: 10px;
        }

        @media (max-width: 600px) {
            .live-view {
                flex-direction: column;
                align-items: center;
            }
            .winner-initials {
                font-size: 8rem;
            }
            .payouts {
                width: 100%;
                max-width: 350px;
            }
            .squares-grid th, .squares-grid td {
                width: 32px;
                height: 32px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="tabs">
        <button class="tab active" onclick="showView('live')">Live</button>
        <button class="tab" onclick="showView('grid')">Grid</button>
    </div>

    <div class="views" id="views">
        <!-- Live View -->
        <div class="view live-view">
            <div class="main">
                <h1>üèà Super Bowl 2026</h1>

                <div class="score-input">
                    <div class="team">
                        <span class="team-name" id="team1-name">SEA</span>
                        <input type="number" id="team1" min="0" value="0" oninput="updateWinner()">
                    </div>
                    <span class="vs">vs</span>
                    <div class="team">
                        <span class="team-name" id="team2-name">NE</span>
                        <input type="number" id="team2" min="0" value="0" oninput="updateWinner()">
                    </div>
                </div>

                <div class="result">
                    <div class="winning-combo" id="combo"></div>
                    <div class="winner-initials" id="winner"></div>
                </div>

                <button class="live-score" onclick="fetchLiveScore()">üî¥ Fetch Live Score</button>
                <div class="status" id="status"></div>
            </div>

            <div class="payouts">
                <h2>Payouts</h2>
                <div class="payout-row">
                    <span class="payout-quarter">Q1</span>
                    <span class="payout-score" id="q1-score">-</span>
                    <span class="payout-winner pending" id="q1-winner">--</span>
                    <span class="payout-amount">$20</span>
                </div>
                <div class="payout-row">
                    <span class="payout-quarter">Half</span>
                    <span class="payout-score" id="q2-score">-</span>
                    <span class="payout-winner pending" id="q2-winner">--</span>
                    <span class="payout-amount">$40</span>
                </div>
                <div class="payout-row">
                    <span class="payout-quarter">Q3</span>
                    <span class="payout-score" id="q3-score">-</span>
                    <span class="payout-winner pending" id="q3-winner">--</span>
                    <span class="payout-amount">$20</span>
                </div>
                <div class="payout-row">
                    <span class="payout-quarter">Final</span>
                    <span class="payout-score" id="q4-score">-</span>
                    <span class="payout-winner pending" id="q4-winner">--</span>
                    <span class="payout-amount">$60</span>
                </div>
                <div class="payout-total">
                    <h3>Totals</h3>
                    <div id="totals-list"></div>
                </div>
            </div>
        </div>

        <!-- Grid View -->
        <div class="view grid-view">
            <h2>All Squares</h2>
            <div class="grid-subtitle">NE (rows) vs SEA (columns)</div>
            <div class="grid-container">
                <table class="squares-grid" id="squares-grid"></table>
            </div>
            <div class="grid-legend">
                <div class="legend-item"><div class="legend-box current"></div> Current</div>
                <div class="legend-item"><div class="legend-box q1"></div> Q1</div>
                <div class="legend-item"><div class="legend-box q2"></div> Half</div>
                <div class="legend-item"><div class="legend-box q3"></div> Q3</div>
            </div>
        </div>
    </div>

    <div class="swipe-hint">Swipe or tap tabs to switch views</div>

    <script>
        // Square assignments from user data
        const squares = {
            "AC": [
                [0,9],[1,7],[1,8],[2,0],[2,3],[2,5],[3,6],[4,3],[4,7],
                [7,3],[7,5],[7,7],[7,8],[8,0]
            ],
            "WX": [
                [0,2],[0,4],[0,6],[1,4],[1,5],[2,2],[3,0],[3,3],[3,8],
                [5,3],[6,8],[7,1],[8,6],[8,9]
            ],
            "CD": [
                [0,3],[0,7],[2,4],[2,6],[2,7],[3,4],[3,7],[3,9],[4,5],
                [4,9],[7,0],[7,9],[8,5],[9,4]
            ],
            "CC": [
                [0,8],[1,0],[1,3],[3,5],[4,0],[4,8],[5,1],[5,2],[7,2],
                [8,1],[8,4],[8,8],[9,0],[9,3]
            ],
            "MK": [
                [0,0],[0,1],[1,1],[1,2],[5,4],[5,5],[5,8],[5,9],[6,6],
                [6,9],[7,4],[7,6],[9,5],[9,6]
            ],
            "RY": [
                [0,5],[1,6],[2,8],[2,9],[3,2],[4,4],[4,6],[5,0],[6,2],
                [6,7],[8,2],[9,1],[9,8],[9,9]
            ],
            "LZ": [
                [1,9],[2,1],[3,1],[4,1],[4,2],[5,6],[6,0],[6,1],[6,3],
                [6,4],[6,5],[8,7],[9,2],[9,7]
            ]
        };

        // Build lookup map: "P-S" -> initials (Patriots digit - Seahawks digit)
        const lookup = {};
        for (const [initials, combos] of Object.entries(squares)) {
            for (const [p, s] of combos) {
                lookup[`${p}-${s}`] = initials;
            }
        }

        // Quarter payouts
        const payouts = { q1: 20, q2: 40, q3: 20, q4: 60 };
        const quarterScores = { q1: null, q2: null, q3: null, q4: null };
        let currentHomeDigit = 0, currentAwayDigit = 0;

        function getWinnerForScore(homeScore, awayScore) {
            const key = `${homeScore % 10}-${awayScore % 10}`;
            return lookup[key] || '???';
        }

        function updatePayouts() {
            const totals = {};

            for (const q of ['q1', 'q2', 'q3', 'q4']) {
                const scores = quarterScores[q];
                const winnerEl = document.getElementById(`${q}-winner`);
                const scoreEl = document.getElementById(`${q}-score`);

                if (scores) {
                    const winner = getWinnerForScore(scores.home, scores.away);
                    winnerEl.textContent = winner;
                    winnerEl.classList.remove('pending');
                    scoreEl.textContent = `${scores.away}-${scores.home}`;

                    if (winner !== '???') {
                        totals[winner] = (totals[winner] || 0) + payouts[q];
                    }
                } else {
                    winnerEl.textContent = '--';
                    winnerEl.classList.add('pending');
                    scoreEl.textContent = '-';
                }
            }

            // Update totals
            const totalsList = document.getElementById('totals-list');
            const sorted = Object.entries(totals).sort((a, b) => b[1] - a[1]);
            totalsList.innerHTML = sorted.length ? sorted.map(([initials, amount]) =>
                `<div class="total-row"><span class="total-initials">${initials}</span><span class="total-amount">$${amount}</span></div>`
            ).join('') : '<div style="color:#666">No winners yet</div>';
        }

        function updateWinner() {
            const awayScore = parseInt(document.getElementById('team1').value) || 0;
            const homeScore = parseInt(document.getElementById('team2').value) || 0;

            currentAwayDigit = awayScore % 10;
            currentHomeDigit = homeScore % 10;

            // Lookup uses Patriots(home)-Seahawks(away) format from squares data
            const key = `${currentHomeDigit}-${currentAwayDigit}`;
            const winner = lookup[key];

            document.getElementById('combo').textContent = `${awayScore} - ${homeScore} (${currentHomeDigit}-${currentAwayDigit})`;

            if (winner) {
                document.getElementById('winner').textContent = winner;
                document.getElementById('winner').className = 'winner-initials';
            } else {
                document.getElementById('winner').textContent = '???';
                document.getElementById('winner').className = 'no-winner';
            }

            updateGrid();
        }

        let autoRefresh = null;

        async function fetchLiveScore() {
            const status = document.getElementById('status');
            status.textContent = 'Fetching live score...';

            try {
                // ESPN API for NFL scores (no API key needed)
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
                const data = await response.json();

                // Find games
                const games = data.events || [];
                let found = false;

                for (const game of games) {
                    const competitors = game.competitions?.[0]?.competitors || [];
                    const gameState = game.status?.type?.state; // pre, in, post

                    if (competitors.length === 2) {
                        const home = competitors.find(c => c.homeAway === 'home');
                        const away = competitors.find(c => c.homeAway === 'away');

                        // Update team names (display as Away vs Home)
                        document.getElementById('team1-name').textContent = away?.team?.abbreviation || 'Away';
                        document.getElementById('team2-name').textContent = home?.team?.abbreviation || 'Home';

                        // Update scores
                        document.getElementById('team1').value = away?.score || 0;
                        document.getElementById('team2').value = home?.score || 0;

                        const currentQuarter = game.status?.period || 0;
                        const clock = game.status?.displayClock || '';
                        const stateText = gameState === 'in' ? `Q${currentQuarter} ${clock}` :
                                         gameState === 'post' ? 'FINAL' : 'Pregame';

                        status.textContent = `üî¥ ${away?.team?.abbreviation} ${away?.score} vs ${home?.team?.abbreviation} ${home?.score} | ${stateText}`;

                        // Get linescore data for quarter-by-quarter scores
                        const homeLinescores = home?.linescores || [];
                        const awayLinescores = away?.linescores || [];

                        // Calculate cumulative scores for each quarter end
                        for (let q = 1; q <= 4; q++) {
                            // Only lock in scores for completed quarters
                            const quarterComplete = (gameState === 'post') || (currentQuarter > q) ||
                                (currentQuarter === q && clock === '0:00');

                            if (quarterComplete && homeLinescores.length >= q) {
                                let homeTotal = 0, awayTotal = 0;
                                for (let i = 0; i < q; i++) {
                                    homeTotal += parseInt(homeLinescores[i]?.value) || 0;
                                    awayTotal += parseInt(awayLinescores[i]?.value) || 0;
                                }
                                quarterScores[`q${q}`] = { home: homeTotal, away: awayTotal };
                            }
                        }

                        updatePayouts();

                        // Auto-refresh every 30s if game is live
                        if (gameState === 'in' && !autoRefresh) {
                            autoRefresh = setInterval(fetchLiveScore, 30000);
                            status.textContent += ' (auto-updating)';
                        }

                        found = true;
                        updateWinner();
                        break;
                    }
                }

                if (!found) {
                    status.textContent = 'No games found. Enter score manually.';
                }
            } catch (err) {
                status.textContent = 'Could not fetch live score. Enter manually.';
                console.error(err);
            }
        }

        // View switching
        function showView(view) {
            const views = document.getElementById('views');
            const tabs = document.querySelectorAll('.tab');

            if (view === 'grid') {
                views.classList.add('show-grid');
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            } else {
                views.classList.remove('show-grid');
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            }
        }

        // Touch swipe support
        let touchStartX = 0;
        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });
        document.addEventListener('touchend', e => {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = touchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    showView('grid');
                } else {
                    showView('live');
                }
            }
        });

        // Build the grid
        function buildGrid() {
            const grid = document.getElementById('squares-grid');
            let html = '<tr><th class="corner">NE‚Üì<br>SEA‚Üí</th>';

            // Header row (Seahawks digits 0-9)
            for (let s = 0; s <= 9; s++) {
                html += `<th>${s}</th>`;
            }
            html += '</tr>';

            // Data rows (Patriots digits 0-9)
            for (let p = 0; p <= 9; p++) {
                html += `<tr><th>${p}</th>`;
                for (let s = 0; s <= 9; s++) {
                    const initials = lookup[`${p}-${s}`] || '?';
                    html += `<td id="cell-${p}-${s}">${initials}</td>`;
                }
                html += '</tr>';
            }

            grid.innerHTML = html;
        }

        // Update grid highlighting
        function updateGrid() {
            // Clear all highlights
            document.querySelectorAll('.squares-grid td').forEach(td => {
                td.classList.remove('winner', 'q1-winner', 'q2-winner', 'q3-winner');
            });

            // Highlight quarter winners
            for (const [q, qClass] of [['q1', 'q1-winner'], ['q2', 'q2-winner'], ['q3', 'q3-winner']]) {
                const scores = quarterScores[q];
                if (scores) {
                    const cell = document.getElementById(`cell-${scores.home % 10}-${scores.away % 10}`);
                    if (cell) cell.classList.add(qClass);
                }
            }

            // Highlight current winner
            const currentCell = document.getElementById(`cell-${currentHomeDigit}-${currentAwayDigit}`);
            if (currentCell) currentCell.classList.add('winner');
        }

        // Initialize
        buildGrid();
        fetchLiveScore();
    </script>
</body>
</html>
